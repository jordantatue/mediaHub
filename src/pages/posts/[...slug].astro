---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  // Point d'entree Astro pour generer les routes statiques (nom impose par Astro).
  const posts = await getCollection('posts');
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();

// Formate la date pour l'en-tete de l'article.
const FormaterDateArticle = (date: Date) =>
  new Intl.DateTimeFormat('fr-FR', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  }).format(date);

const dateFormatee = FormaterDateArticle(post.data.date);
---

<Layout title={post.data.title} description={post.data.excerpt}>
  <article class="py-5">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-12 col-lg-9">
          <header class="mb-4">
            <div class="d-flex flex-wrap align-items-center gap-3 mb-3">
              <span class="badge text-bg-primary text-uppercase">{post.data.category}</span>
              <time class="text-muted" datetime={post.data.date.toISOString()}>
                {dateFormatee}
              </time>
            </div>

            <h1 class="display-5 fw-bold mb-3">{post.data.title}</h1>
            <p class="lead text-muted mb-3">{post.data.excerpt}</p>

            <div class="text-muted small">
              <span class="fw-semibold text-primary">Source : {post.data.source}</span>
            </div>
          </header>

          <figure class="mb-5">
            <img
              src={post.data.image}
              alt={post.data.imageAlt}
              class="img-fluid w-100 rounded-3 shadow-sm"
              loading="eager"
              decoding="async"
            />
          </figure>

          <div class="fs-5 lh-lg mb-5">
            <Content />
          </div>

          <footer class="border-top pt-4">
            <a href="/" class="btn btn-outline-primary">
              ‚Üê Retour aux articles
            </a>
          </footer>
        </div>
      </div>
    </div>
  </article>
</Layout>
